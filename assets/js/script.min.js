"use strict";const storageRepoItem={name:"_db_repo",byDefault:"twoweeks/db"};$create.db={icon:e=>`<i class="material-icons">${e}</i>`,textBlocks:e=>`<span class="_tb">${e.replace(/\n/g,'</span><span class="_tb">')}</span>`,time:e=>new Date(1e3*e).toLocaleDateString([],{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})};const parseLocalNames=e=>{const t=$make.qs(".names"),a=$create.elem("ul");e.forEach((e=>{let t=$create.elem("li"),n=$create.elem("button",e.name,"btn btn--name");if(n.dataset.name=e.file,e.altNames&&0!=e.altNames.length){let t=$create.elem("ul","","btn--name__alt-names-list");e.altNames.forEach((e=>{let a=$create.elem("li",e);t.appendChild(a)})),n.appendChild(t)}n.addEventListener("click",(t=>{selectName({name:e.file})})),t.appendChild(n),a.appendChild(t)})),t.appendChild(a)},parseGame=e=>{if(!e)return;let t=e,a=$create.elem("div","","comp_games--game _game");if("image"in t&&""!=t.image){let e=$create.elem("picture","","_game__image"),n=$create.elem("img");n.dataset.src=t.image,n.addEventListener("error",(n=>{a.classList.add("_game--no-image"),e.remove(),console.warn(`Ошибка загрузки картинки у игры "${t.name}".`)})),"loading"in HTMLImageElement.prototype&&n.setAttribute("loading","lazy"),e.appendChild(n),a.appendChild(e)}else a.classList.add("_game--no-image");let n=$create.elem("div","","_game__info"),i=e=>{let a="Неизвестный статус";switch(e){case"win":case"1":a="Победитель";break;case"2":case"3":case"4":a=`${t.status} место`;break;case"final":a="Финалист";break;case"demo":a="Демоверсия";break;case"updated":a="Обновлённая версия";break;case"disqualified":a="Дисквалификация"}return a},d=i(t.status);if("status"in t&&""!=t.status){let e=$create.elem("div",$create.db.icon("disqualified"!=t.status?"star":"close"),`_game__info--status _status _status--${t.status&&""!=t.status?t.status:"empty"}`);e.firstChild.setAttribute("title",d),n.appendChild(e)}else console.warn(`${d} у ${t.name}`);let s=$create.elem("h2","","_game__info--name _middle");if(s.appendChild($create.elem("span","name"in t&&""!=t.name?t.name:"Названия нет")),n.appendChild(s),"genre"in t&&""!=t.genre&&n.appendChild($create.elem("p",`Жанр: ${t.genre}`)),n.appendChild($create.elem("div",t.description?$create.db.textBlocks(t.description):"Описания нет.","_game__info--description")),"tools"in t&&""!=t.tools&&n.appendChild($create.elem("p",`Инструменты: ${t.tools}`)),"dependencies"in t&&""!=t.dependencies&&n.appendChild($create.elem("p",`Зависимости: ${t.dependencies}`)),"note"in t&&""!=t.note&&n.appendChild($create.elem("p",`Примечание: ${t.note}`)),"links"in t&&0!=Object.keys(t.links)){let e=(e=>{let t=$create.elem("table","","_game__info--links");t.appendChild($create.elem("caption","Ссылки:"));let a=[];return a=(e=>{let t=[],a=["site","store","source","updated","final","dlc","demo_updated","demo","ost"];for(let i of a)i in e&&(n={type:i,content:e[i]},t.push(n));var n;return t})(e),a.forEach((a=>{let n=$create.elem("tr"),i=(e,t)=>{t||(t="html"),n.innerHTML="html"==t?e:e()},d=(e,t)=>{t||(t="standart");let a=$create.elem("ul"),n=(e,t,n)=>a.appendChild($create.elem("li",$create.link(e,t,n,["e","html"])));switch(t){case"store":"steam"in e&&n(`https://store.steampowered.com/app/${e.steam}`,"Steam"),"gplay"in e&&n(`https://play.google.com/store/apps/details?id=${e.gplay}`,"Google Play"),"itunes"in e&&n(`https://itunes.apple.com/app/id${e.itunes}`,"App Store"),"itch"in e&&n(`https://${e.itch.user}.itch.io/${e.itch.game}`,"itch.io"),"gamejolt"in e&&n(`https://gamejolt.com/games/${e.gamejolt}`,"Game Jolt");break;case"standart":"yadisk"in e&&n(`https://yadi.sk/d/${e.yadisk}`,"Яндекс.Диск"),"gdrive"in e&&n(`https://drive.google.com/open?id=${e.gdrive}`,"Google Drive"),"web"in e&&n(e.web,"Онлайн-версия");break;case"source":"repo"in e&&("github"in e.repo&&n(`https://github.com/${e.repo.github}`,"GitHub"),"bitbucket"in e.repo&&n(`https://bitbucket.com/${e.repo.bitbucket}`,"BitBucket")),"link"in e&&n(e.link,"Ссылка");break;case"ost":"soundcloud"in e&&n(`https://soundcloud.com/${e.soundcloud}`,"SoundCloud")}return a.outerHTML};switch(a.type){case"site":i(`<td>Сайт игры:</td><td>${$create.link(e[a.type],e[a.type].replace(/^(https?):\/\//,""),"",["e","html"])}</td>`);break;case"store":i(`<td>Магазины</td><td>${d(a.content,a.type)}</td>`);break;case"updated":i(`<td>Обновлённая финальная версия</td><td>${d(a.content)}</td>`);break;case"final":i(`<td>Финальная версия</td><td>${d(a.content)}</td>`);break;case"dlc":i(`<td>DLC</td><td>${d(a.content)}</td>`);break;case"demo_updated":i(`<td>Обновлённая демоверсия</td><td>${d(a.content)}</td>`);break;case"demo":i(`<td>Демоверсия</td><td>${d(a.content)}</td>`);break;case"source":i(`<td>Исходный код</td><td>${d(a.content,a.type)}</td>`);break;case"ost":i(`<td>Саундтрек</td><td>${d(a.content,a.type)}</td>`)}t.appendChild(n)})),t})(t.links);n.appendChild(e)}if("repeat"in t&&""!=t.repeat){let e=i(t.repeat);n.appendChild($create.elem("p",`<i>P.S. Эта игра также была отправлена в параллельно проходящий конкурс как ${e}.</i>`,"_game__info--repeat"))}return a.appendChild(n),a},getCompData=e=>{let t="file"in e&&""!=e.file?e.file:"twg",a=`https://raw.githubusercontent.com/${"repo"in e&&""!=e.repo?e.repo:storageRepoItem.byDefault}/master/json/min`,n="https://cdn.blyat.science/gd",i=$make.qs(".comps-list"),d=$make.qs(".comps"),s=e=>{let a=[...$make.qsf(".btn--comp",i,["a"]),...$make.qsf(".comp",d,["a"])];"edition"in e||(e.edition="_none");let s=!1;if(a.forEach((a=>{let i=a.dataset;if("selected"in i&&delete i.selected,i.num==e.num&&i.edition==e.edition){i.selected="",s=!0;let d="_none"!=e.edition?`&edition=${e.edition}`:"";if(history.pushState("",document.title,`${window.location.pathname}?get=${t}&comp=${e.num}${d}`),a.classList.contains("btn")&&a.scrollIntoView({inline:"center",block:"center",behavior:"smooth"}),a.classList.contains("comp")){$make.qsf("._game__image > img",a,["a"]).forEach((e=>{let t=e.dataset;"src"in t&&""!=t.src&&(e.setAttribute("src",`${n}/${t.src}`),delete t.src)}))}}})),!s)throw`Запрошенного конкурса ${t} под номером ${e.num} (${"_none"==e.edition?"без Edition":`${e.edition} Edition`}) нет в базе данных.`};fetch(`${a}/${t}.json`).then((e=>{if(e.ok)return i.innerText="",d.innerText="",e.json();throw`Запрошенного конкурса "${t}" нет в базе данных.`})).then((e=>{let t=$create.elem("ul");e.forEach(((e,a)=>{let n=$create.elem("li"),i=$create.elem("button","","btn btn--comp");i.appendChild($create.elem("span",`Конкурс №${e.meta.num}`));let l="edition"in e.meta&&""!=e.meta.edition,o="aka"in e.meta&&""!=e.meta.aka;n.appendChild(i),t.appendChild(n);let c=$create.elem("div","","comp");c.dataset.num=e.meta.num,i.dataset.num=e.meta.num;let m=$create.elem("div","","comp__header"),r=$create.elem("div","","comp__games"),p=$create.elem("h2",`<span>Конкурс №${e.meta.num}</span>`,"comp__header--title");if("site"in e&&""!=e.site){let t=$create.link(e.site,$create.db.icon("home"),"",["e"]);t.setAttribute("title","Сайт конкурса"),p.appendChild(t)}if(l){let t=$create.elem("small",`${e.meta.edition} Edition`);p.appendChild(t)}if(o){let t=$create.elem("small",`aka ${e.meta.aka}`);p.appendChild(t)}if(m.appendChild(p),"themes"in e&&0!=e.themes.length){let t=$create.elem("ul","","comp__header--themes");e.themes.forEach((e=>{let a=$create.elem("li");a.appendChild($create.elem("p",`${$create.db.icon("label")}<span>${e.name}</span>`,"_middle")),"description"in e&&""!=e.description&&a.appendChild($create.elem("p",$create.db.textBlocks(e.description))),t.appendChild(a)})),m.appendChild(t)}if("note"in e&&""!=e.note){let t=$create.elem("div",$create.elem("p",$create.db.textBlocks(`Примечание: ${e.note}`),"",["html"]),"comp__header--note");m.appendChild(t)}if("achievements"in e&&""!=e.achievements){let t=$create.elem("details","","comp__header--ach"),a=$create.elem("ul"),n=$create.elem("summary","","btn btn--nfw");n.dataset.openText="Открыть ачивки",n.dataset.hideText="Скрыть ачивки",t.appendChild(n),e.achievements.forEach((e=>{let t=$create.elem("li");t.appendChild($create.elem("p",`${$create.db.icon("place")}<span>${e.name}</span>`,"comp__header--ach _middle")),"description"in e&&""!=e.description&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Описание</b>: ${e.description}`),"comp__header--ach")),"gift"in e&&""!=e.gift&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Приз</b>: ${e.gift}`))),"winner"in e&&""!=e.winner&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Победитель</b>: ${e.winner}`))),a.appendChild(t)})),t.appendChild(a),m.appendChild(t)}if("fund"in e&&""!=e.fund){let t=$create.elem("div",$create.elem("p",`Призовой фонд: ${e.fund}`,"",["html"]),"comp__header--fund");m.appendChild(t)}if("dates"in e){let t=$create.elem("div","","comp__header--dates");"start"in e.dates&&t.appendChild($create.elem("p",`Начало конкурса: ${$create.db.time(e.dates.start)}`)),"end"in e.dates&&t.appendChild($create.elem("p",`Конец конкурса: ${$create.db.time(e.dates.end)}`)),m.appendChild(t)}c.appendChild(m),"games"in e&&0!=e.games.length&&(e.games.forEach(((t,a)=>{"disqualified"==t.status&&(delete e.games[a],e.games.push(t))})),e.games.forEach((e=>{let t=parseGame(e);r.appendChild(t)}))),r.dataset.noGamesText="Игр нет. Возможно, больше информации есть на сайте конкурса.",c.appendChild(r),d.appendChild(c);let h={num:e.meta.num};if(l){i.dataset.edition=e.meta.edition,c.dataset.edition=e.meta.edition,h.edition=e.meta.edition;let t=$create.elem("p",`${e.meta.edition} Edition`,"btn--comp__mini");i.appendChild(t)}else i.dataset.edition="_none",c.dataset.edition="_none",h.edition="_none";if(o){let t=$create.elem("p",`aka ${e.meta.aka}`,"btn--comp__mini");i.appendChild(t)}0==a&&sessionStorage.setItem("db_firstCompInFile",JSON.stringify(h)),i.addEventListener("click",(e=>{s(h)}))})),i.appendChild(t);let a=JSON.parse(sessionStorage.getItem("db_firstCompInFile")),n=JSON.parse(sessionStorage.getItem("db_compFromURL"));n&&Object.keys(n).includes("num")&&(a=n,sessionStorage.removeItem("db_compFromURL")),s(a)})).catch((e=>{alert(e)}))},selectName=e=>{let t="name"in e&&""!=e.name?e.name:"twg",a="repo"in e&&""!=e.repo?e.repo:$ls.get(storageRepoItem.name),n=$make.qs(".names"),i=$make.qsf(".btn--name",n,["a"]),d=n.dataset;d.selected!=t&&(getCompData({file:t,repo:a}),i.forEach((e=>{let a=e.dataset;d.selected!=t&&("selected"in a&&delete a.selected,a.name==t&&(e.scrollIntoView({inline:"center",block:"center",behavior:"smooth"}),a.selected=""))})),d.selected=t)};document.addEventListener("DOMContentLoaded",(()=>{let e=document.body,t=$make.qs(".container");e.classList.remove("no-js"),t.innerText="",new Array("warning","names","comps-list","comps").forEach((e=>{t.appendChild($create.elem("div","",e))})),e.insertBefore(t,e.firstChild);const a=$make.qsf(".warning",t),n="op@gdjams.ru",i=$create.elem("p",`Внимание! Обновления <a href="https://github.com/twoweeks/db" target="_blank" rel="nofollow noopener">базы данных</a> по конкурсам более не производятся. Если вы готовы взять на себя её поддержку, напишите на почту <a href="mailto:${n}">${n}</a>.`),d=$create.elem("button","Закрыть");d.addEventListener("click",(()=>{a.hidden=!0})),i.appendChild(d),a.appendChild(i),parseLocalNames([{name:"Two Weeks Game",file:"twg"},{name:"Two-Two Weeks Game",file:"ttwg"},{name:"One Week Game",altNames:["Two/Two Weeks Game"],file:"owg"},{name:"Three Days Game",file:"three-dg"},{name:"Two Days Game",file:"two-dg"},{name:"Molnija Jam",file:"molnija"},{name:"Toxic Jam",file:"toxic"},{name:"RUVN Contest",file:"ruvn-contest"}]),$ls.get(storageRepoItem.name)||$ls.set(storageRepoItem.name,storageRepoItem.byDefault);let s={};switch($check.get("comp")){case null:case!0:case"":break;default:s.num=$check.get("comp")}switch($check.get("edition")){case null:case!0:case"":case"_none":break;default:s.edition=$check.get("edition")}sessionStorage.setItem("db_compFromURL",JSON.stringify(s));let l="";switch($check.get("get")){case null:case!0:case"":l="twg";break;default:l=$check.get("get")}selectName({name:l,repo:$ls.get(storageRepoItem.name)})}));